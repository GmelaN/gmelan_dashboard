<html layout:decorate="~{layout/base}">
<div layout:fragment="content">
  <script>
    // 할 일 삭제 함수
    function deleteTodo(taskId) {
      const url = `/todos/delete/${taskId}`;

      fetch(url, {
        method: 'DELETE',
      })
              .then(response => {
                if (response.ok) {
                  console.log('Todo deleted successfully');
                } else {
                  console.log(response);
                  console.error('Failed to delete todoEntity');
                }
              })
              .catch(error => {
                console.error('Error:', error);
              });
    }
  </script>
  <!-- title -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">TO-DO 리스트</h1>
  </div>

  <div class="container-fluid">
    <!-- Add Todo_ Form -->
    <form th:action="@{/todos/{userId}/createTodo(userId=${userId})}" method="post">
      <label for="title">할 일 제목:</label>
      <input type="text" id="title" name="title" required>

      <label for="content">내용:</label>
      <input type="text" id="content" name="content">

      <label for="url">URL:</label>
      <input type="text" id="url" name="url">

      <label for="startDate">시작일:</label>
      <input type="date" id="startDate" name="startDate">

      <label for="endDate">종료일:</label>
      <input type="date" id="endDate" name="endDate">

      <label for="category">카테고리:</label>
      <input type="text" id="category" name="category">

      <button type="submit" class="btn btn-info btn-light btn-sm">
        <i class="fas fa-plus-circle fa-lg"></i> Add Todo
      </button>
    </form>

  </div>

    <div class="row mt-3">
      <div class="col-lg-12">
        <div class="card shadow mb-4">
          <div class="collapse show">
            <div class="card-body">
              <table class="table">
                <thead>
                <tr>
                  <th>제목</th>
                  <th>내용</th>
                  <th>URL</th>
                  <th>카테고리</th>
                  <th>등록일</th>
                  <th>시작일</th>
                  <th>마감일</th>
                  <th>작업</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(todoList)}">
                  <!-- todo: 입력값이 NULL인 경우 처리-->
                  <td colspan="4">할 일이 없습니다.</td>
                </tr>

                <tr th:each="todo : ${todoList}">
                  <td th:text="${todo.getTitle() != null ? todo.getTitle() : '제목 없음'}"></td>
                  <td th:text="${todo.getContent() != null ? todo.getContent() : '내용 없음'}"></td>
                  <td th:text="${todo.getUrl() != null ? todo.getUrl() : 'URL 없음'}"></td>
                  <td th:text="${todo.getTodoCategoryEntity() != null ? todo.getTodoCategoryEntity().getName() : '카테고리 없음'}"></td>
                  <td th:text="${todo.getStartDate() != null ? todo.getStartDate().toString() : '-'}"></td>
                  <td th:text="${todo.getEndDate() != null ? todo.getEndDate().toString() : '-'}"></td>
                  <td th:text="${todo.getCreatedAt() != null ? todo.getCreatedAt().toString() : '-'}"></td>

                  <td>
                    <button class="btn btn-danger" th:onclick="'deleteTodo('+ ${todo.getId()} + ')'">삭제</button>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</html>
